<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Irc::Bot::Auth::ManagerClass
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../../';
  framesUrl = "../../../frames.html#!Irc/Bot/Auth/ManagerClass.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../../_index.html">Index (M)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../../Irc.html" title="Irc (module)">Irc</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../../Bot.html" title="Irc::Bot (class)">Bot</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Auth.html" title="Irc::Bot::Auth (module)">Auth</a></span></span>
     &raquo; 
    <span class="title">ManagerClass</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Irc::Bot::Auth::ManagerClass
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Irc::Bot::Auth::ManagerClass</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
      <dt class="r2">Includes:</dt>
      <dd class="r2"><span class='object_link'><a href="../../../Singleton.html" title="Singleton (module)">Singleton</a></span></dd>
      
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>This is the ManagerClass singleton, used to manage
Irc::User/Irc::Bot::Auth::BotUser connections and everything</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bot-instance_method" title="#bot (instance method)">- (Object) <strong>bot</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute bot.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#botowner-instance_method" title="#botowner (instance method)">- (Object) <strong>botowner</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute botowner.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#everyone-instance_method" title="#everyone (instance method)">- (Object) <strong>everyone</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute everyone.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#maskdb-instance_method" title="#maskdb (instance method)">- (Object) <strong>maskdb</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the value of attribute maskdb.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#allow%3F-instance_method" title="#allow? (instance method)">- (Boolean) <strong>allow?</strong>(cmdtxt, user, chan = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if command <em>cmd</em> is allowed to User <em>user</em> on
<em>chan</em>, optionally telling if the user is authorized.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#autologin-instance_method" title="#autologin (instance method)">- (Object) <strong>autologin</strong>(user) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Tries to auto-login Irc::User <em>user</em> by looking at the known
botusers that allow autologin and trying to login without a password.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#bot_associate-instance_method" title="#bot_associate (instance method)">- (Object) <strong>bot_associate</strong>(bot) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#changed%3F-instance_method" title="#changed? (instance method)">- (Boolean) <strong>changed?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_botuser-instance_method" title="#create_botuser (instance method)">- (Object) <strong>create_botuser</strong>(name, password = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>creates a new BotUser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#create_transient_botuser-instance_method" title="#create_transient_botuser (instance method)">- (Object) <strong>create_transient_botuser</strong>(user) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new transient BotUser associated with Irc::User <em>user</em>,
automatically logging him in.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#get_botuser-instance_method" title="#get_botuser (instance method)">- (Object) <strong>get_botuser</strong>(name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>returns the botuser with name <em>name</em>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#include%3F-instance_method" title="#include? (instance method)">- (Boolean) <strong>include?</strong>(botusername) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>checks if we know about a certain BotUser username.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (ManagerClass) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The instance manages two Hashes: one that maps Irc::Users onto BotUsers,
and the other that maps usernames onto BotUser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#irc_to_botuser-instance_method" title="#irc_to_botuser (instance method)">- (Object) <strong>irc_to_botuser</strong>(ircuser) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Maps Irc::User to BotUser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#load_array-instance_method" title="#load_array (instance method)">- (Object) <strong>load_array</strong>(ary, forced) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#login-instance_method" title="#login (instance method)">- (Object) <strong>login</strong>(user, botusername, pwd = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Logs Irc::User <em>user</em> in to BotUser <em>botusername</em> with
password <em>pwd</em>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#logout_transients-instance_method" title="#logout_transients (instance method)">- (Object) <strong>logout_transients</strong>(m) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Logs out any Irc::User matching Irc::Netmask <em>m</em> and logged in to a
transient BotUser.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#make_permanent-instance_method" title="#make_permanent (instance method)">- (Object) <strong>make_permanent</strong>(user, name) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Makes transient BotUser <em>user</em> into a permanent BotUser named
<em>name</em>; if <em>user</em> is an Irc::User, act on the transient
BotUser (if any) it&#39;s logged in as.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#permit%3F-instance_method" title="#permit? (instance method)">- (Boolean) <strong>permit?</strong>(user, cmdtxt, channel = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks if User <em>user</em> can do <em>cmd</em> on <em>chan</em>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_changed-instance_method" title="#reset_changed (instance method)">- (Object) <strong>reset_changed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset_hashes-instance_method" title="#reset_hashes (instance method)">- (Object) <strong>reset_hashes</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>resets the hashes.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#save_array-instance_method" title="#save_array (instance method)">- (Object) <strong>save_array</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#set_changed-instance_method" title="#set_changed (instance method)">- (Object) <strong>set_changed</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
    </ul>
  


  
  
  
  
  
  
  
  
  <h3 class="inherited">Methods included from <span class='object_link'><a href="../../../Singleton.html" title="Singleton (module)">Singleton</a></span></h3>
  <p class="inherited"><span class='object_link'><a href="../../../Singleton.html#_dump-instance_method" title="Singleton#_dump (method)">#_dump</a></span></p>
<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Irc::Bot::Auth::ManagerClass (class)">ManagerClass</a></span></tt>) <strong>initialize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The instance manages two <code>Hash</code>es: one that maps
<code>Irc::User</code>s onto <code>BotUser</code>s, and the other that maps
usernames onto <code>BotUser</code></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


663
664
665
666
667</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 663</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@everyone</span> <span class='op'>=</span> <span class='const'>Auth</span><span class='op'>::</span><span class='id identifier rubyid_defaultbotuser'>defaultbotuser</span>
  <span class='ivar'>@botowner</span> <span class='op'>=</span> <span class='const'>Auth</span><span class='op'>::</span><span class='id identifier rubyid_botowner'>botowner</span>
  <span class='id identifier rubyid_bot_associate'>bot_associate</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="bot-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bot</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute bot</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


658
659
660</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 658</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bot'>bot</span>
  <span class='ivar'>@bot</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="botowner-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>botowner</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute botowner</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


657
658
659</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 657</span>

<span class='kw'>def</span> <span class='id identifier rubyid_botowner'>botowner</span>
  <span class='ivar'>@botowner</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="everyone-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>everyone</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute everyone</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


656
657
658</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 656</span>

<span class='kw'>def</span> <span class='id identifier rubyid_everyone'>everyone</span>
  <span class='ivar'>@everyone</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="maskdb-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>maskdb</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the value of attribute maskdb</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


655
656
657</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 655</span>

<span class='kw'>def</span> <span class='id identifier rubyid_maskdb'>maskdb</span>
  <span class='ivar'>@maskdb</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="allow?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>allow?</strong>(cmdtxt, user, chan = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if command <em>cmd</em> is allowed to User <em>user</em> on
<em>chan</em>, optionally telling if the user is authorized</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


908
909
910
911
912
913
914
915
916
917
918</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 908</span>

<span class='kw'>def</span> <span class='id identifier rubyid_allow?'>allow?</span><span class='lparen'>(</span><span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='comma'>,</span> <span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>else</span>
    <span class='comment'># cmds = cmdtxt.split(&#39;::&#39;)
</span>    <span class='comment'># @bot.say chan, &quot;you don&#39;t have #{cmds.last} (#{cmds.first}) permissions here&quot; if chan
</span>    <span class='ivar'>@bot</span><span class='period'>.</span><span class='id identifier rubyid_say'>say</span> <span class='id identifier rubyid_chan'>chan</span><span class='comma'>,</span> <span class='id identifier rubyid__'>_</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>%{user}, you don&#39;t have &#39;%{command}&#39; permissions here</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='op'>%</span>
                  <span class='lbrace'>{</span><span class='symbol'>:user</span><span class='op'>=&gt;</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='symbol'>:command</span><span class='op'>=&gt;</span><span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_chan'>chan</span>
    <span class='kw'>return</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="autologin-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>autologin</strong>(user) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Tries to auto-login Irc::User <em>user</em> by looking at the known
botusers that allow autologin and trying to login without a password</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


784
785
786
787
788
789
790
791
792
793
794
795
796
797
798
799
800
801
802</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 784</span>

<span class='kw'>def</span> <span class='id identifier rubyid_autologin'>autologin</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ircuser'>ircuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_user'>to_irc_user</span>
  <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Trying to autologin </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>return</span> <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rbracket'>]</span> <span class='kw'>if</span> <span class='ivar'>@botusers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='id identifier rubyid_maskdb'>maskdb</span><span class='period'>.</span><span class='id identifier rubyid_find'>find</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_bu'>bu</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>trying </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_bu'>bu</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_bu'>bu</span><span class='period'>.</span><span class='id identifier rubyid_login'>login</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>...what?!</span><span class='tstring_end'>&#39;</span></span>
    <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_bu'>bu</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_bu'>bu</span>
  <span class='kw'>end</span>
  <span class='comment'># Finally, create a transient if we&#39;re set to allow it
</span>  <span class='kw'>if</span> <span class='ivar'>@bot</span><span class='period'>.</span><span class='id identifier rubyid_config'>config</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>auth.autouser</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='id identifier rubyid_create_transient_botuser'>create_transient_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
    <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_bu'>bu</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_bu'>bu</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_everyone'>everyone</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="bot_associate-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bot_associate</strong>(bot) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


669
670
671
672
673
674
675
676
677
678
679
680</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 669</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bot_associate'>bot_associate</span><span class='lparen'>(</span><span class='id identifier rubyid_bot'>bot</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Cannot associate with a new bot! Save first</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='kw'>defined?</span><span class='lparen'>(</span><span class='ivar'>@has_changes</span><span class='rparen'>)</span> <span class='op'>&amp;&amp;</span> <span class='ivar'>@has_changes</span>

  <span class='id identifier rubyid_reset_hashes'>reset_hashes</span>

  <span class='comment'># Associated bot
</span>  <span class='ivar'>@bot</span> <span class='op'>=</span> <span class='id identifier rubyid_bot'>bot</span>

  <span class='comment'># This variable is set to true when there have been changes
</span>  <span class='comment'># to the botusers list, so that we know when to save
</span>  <span class='ivar'>@has_changes</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="changed?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>changed?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


690
691
692</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 690</span>

<span class='kw'>def</span> <span class='id identifier rubyid_changed?'>changed?</span>
  <span class='ivar'>@has_changes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_botuser-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>create_botuser</strong>(name, password = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>creates a new BotUser</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


742
743
744
745
746
747
748
749
750</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 742</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_botuser'>create_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='comma'>,</span> <span class='id identifier rubyid_password'>password</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_username'>sanitize_username</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>botuser </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='embexpr_end'>}</span><span class='tstring_content'> exists</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_n'>n</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_bu'>bu</span><span class='period'>.</span><span class='id identifier rubyid_password'>password</span> <span class='op'>=</span> <span class='id identifier rubyid_password'>password</span>
  <span class='ivar'>@allbotusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_bu'>bu</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_bu'>bu</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_transient_botuser-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>create_transient_botuser</strong>(user) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new transient BotUser associated with Irc::User <em>user</em>,
automatically logging him in. Note that transient botuser creation can
fail, typically if we don&#39;t have the complete user netmask (e.g. for
messages coming in from a linkbot)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


809
810
811
812
813
814
815
816
817
818
819
820</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 809</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_transient_botuser'>create_transient_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ircuser'>ircuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_user'>to_irc_user</span>
  <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='id identifier rubyid_everyone'>everyone</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='comma'>,</span> <span class='symbol'>:transient</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='comma'>,</span> <span class='symbol'>:masks</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_bu'>bu</span><span class='period'>.</span><span class='id identifier rubyid_login'>login</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
  <span class='kw'>rescue</span>
    <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>failed to create transient for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_error'>error</span> <span class='gvar'>$!</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_bu'>bu</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_botuser-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>get_botuser</strong>(name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>returns the botuser with name <em>name</em></p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


753
754
755</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 753</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_botuser'>get_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='ivar'>@allbotusers</span><span class='period'>.</span><span class='id identifier rubyid_fetch'>fetch</span><span class='lparen'>(</span><span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_username'>sanitize_username</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="include?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>include?</strong>(botusername) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>checks if we know about a certain BotUser username</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


730
731
732</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 730</span>

<span class='kw'>def</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_botusername'>botusername</span><span class='rparen'>)</span>
  <span class='ivar'>@allbotusers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_botusername'>botusername</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="irc_to_botuser-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>irc_to_botuser</strong>(ircuser) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Maps <code>Irc::User</code> to BotUser</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


735
736
737
738
739</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 735</span>

<span class='kw'>def</span> <span class='id identifier rubyid_irc_to_botuser'>irc_to_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_logged'>logged</span> <span class='op'>=</span> <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_user'>to_irc_user</span><span class='rbracket'>]</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_logged'>logged</span> <span class='kw'>if</span> <span class='id identifier rubyid_logged'>logged</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_autologin'>autologin</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="load_array-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>load_array</strong>(ary, forced) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


704
705
706
707
708
709
710
711
712
713
714
715
716
717
718
719
720
721</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 704</span>

<span class='kw'>def</span> <span class='id identifier rubyid_load_array'>load_array</span><span class='lparen'>(</span><span class='id identifier rubyid_ary'>ary</span><span class='comma'>,</span> <span class='id identifier rubyid_forced'>forced</span><span class='rparen'>)</span>
  <span class='kw'>unless</span> <span class='id identifier rubyid_ary'>ary</span>
    <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tried to load an empty array</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Won&#39;t load with unsaved changes</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='ivar'>@has_changes</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='id identifier rubyid_forced'>forced</span>
  <span class='id identifier rubyid_reset_hashes'>reset_hashes</span>
  <span class='id identifier rubyid_ary'>ary</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_x'>x</span><span class='embexpr_end'>}</span><span class='tstring_content'> should be a Hash</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Hash</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span><span class='lbracket'>[</span><span class='symbol'>:username</span><span class='rbracket'>]</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_create_botuser'>create_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_get_botuser'>get_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_from_hash'>from_hash</span><span class='lparen'>(</span><span class='id identifier rubyid_x'>x</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_get_botuser'>get_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_transient'>transient</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='rbrace'>}</span>
  <span class='ivar'>@has_changes</span><span class='op'>=</span><span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="login-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>login</strong>(user, botusername, pwd = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Logs Irc::User <em>user</em> in to BotUser <em>botusername</em> with
password <em>pwd</em></p>

<p>raises an error if <em>botusername</em> is not a known BotUser username</p>

<p>It is possible to autologin by Netmask, on request</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 763</span>

<span class='kw'>def</span> <span class='id identifier rubyid_login'>login</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_botusername'>botusername</span><span class='comma'>,</span> <span class='id identifier rubyid_pwd'>pwd</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_ircuser'>ircuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_user'>to_irc_user</span>
  <span class='id identifier rubyid_n'>n</span> <span class='op'>=</span> <span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_username'>sanitize_username</span><span class='lparen'>(</span><span class='id identifier rubyid_botusername'>botusername</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_k'>k</span> <span class='op'>=</span> <span class='id identifier rubyid_n'>n</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No such BotUser </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_n'>n</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_k'>k</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='ivar'>@botusers</span><span class='period'>.</span><span class='id identifier rubyid_has_key?'>has_key?</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='kw'>true</span> <span class='kw'>if</span> <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span> <span class='op'>==</span> <span class='id identifier rubyid_n'>n</span>
    <span class='comment'># TODO
</span>    <span class='comment'># @botusers[ircuser].logout(ircuser)
</span>  <span class='kw'>end</span>
  <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='ivar'>@allbotusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_k'>k</span><span class='rbracket'>]</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_bu'>bu</span><span class='period'>.</span><span class='id identifier rubyid_login'>login</span><span class='lparen'>(</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='comma'>,</span> <span class='id identifier rubyid_pwd'>pwd</span><span class='rparen'>)</span>
    <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_ircuser'>ircuser</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_bu'>bu</span>
    <span class='kw'>return</span> <span class='kw'>true</span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="logout_transients-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>logout_transients</strong>(m) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Logs out any Irc::User matching Irc::Netmask <em>m</em> and logged in to a
transient BotUser</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


825
826
827
828
829
830
831
832
833
834</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 825</span>

<span class='kw'>def</span> <span class='id identifier rubyid_logout_transients'>logout_transients</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to check: </span><span class='embexpr_beg'>#{</span><span class='ivar'>@botusers</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='ivar'>@botusers</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_iu'>iu</span><span class='op'>|</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>checking </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_iu'>iu</span><span class='period'>.</span><span class='id identifier rubyid_fullform'>fullform</span><span class='embexpr_end'>}</span><span class='tstring_content'> against </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='period'>.</span><span class='id identifier rubyid_fullform'>fullform</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_bu'>bu</span> <span class='op'>=</span> <span class='ivar'>@botusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_iu'>iu</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_bu'>bu</span><span class='period'>.</span><span class='id identifier rubyid_transient?'>transient?</span> <span class='kw'>or</span> <span class='kw'>next</span>
    <span class='id identifier rubyid_iu'>iu</span><span class='period'>.</span><span class='id identifier rubyid_matches?'>matches?</span><span class='lparen'>(</span><span class='id identifier rubyid_m'>m</span><span class='rparen'>)</span> <span class='kw'>or</span> <span class='kw'>next</span>
    <span class='ivar'>@botusers</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_iu'>iu</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_autologin'>autologin</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_permanent-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>make_permanent</strong>(user, name) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Makes transient BotUser <em>user</em> into a permanent BotUser named
<em>name</em>; if <em>user</em> is an Irc::User, act on the transient
BotUser (if any) it&#39;s logged in as</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>TypeError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


840
841
842
843
844
845
846
847
848
849
850
851
852
853
854
855
856
857
858
859
860
861</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 840</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_permanent'>make_permanent</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_buname'>buname</span> <span class='op'>=</span> <span class='const'>BotUser</span><span class='period'>.</span><span class='id identifier rubyid_sanitize_username'>sanitize_username</span><span class='lparen'>(</span><span class='id identifier rubyid_name'>name</span><span class='rparen'>)</span>
  <span class='comment'># TODO merge BotUser instead?
</span>  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>there&#39;s already a BotUser called </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_name'>name</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_buname'>buname</span><span class='rparen'>)</span>

  <span class='id identifier rubyid_tuser'>tuser</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_user'>user</span>
  <span class='kw'>when</span> <span class='const'>String</span><span class='comma'>,</span> <span class='const'>Irc</span><span class='op'>::</span><span class='const'>User</span>
    <span class='id identifier rubyid_tuser'>tuser</span> <span class='op'>=</span> <span class='id identifier rubyid_irc_to_botuser'>irc_to_botuser</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='const'>BotUser</span>
    <span class='id identifier rubyid_tuser'>tuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sorry, don&#39;t know how to make </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span><span class='embexpr_end'>}</span><span class='tstring_content'> into a permanent BotUser</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>unless</span> <span class='id identifier rubyid_tuser'>tuser</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>TypeError</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tuser'>tuser</span><span class='embexpr_end'>}</span><span class='tstring_content'> is not transient</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>unless</span> <span class='id identifier rubyid_tuser'>tuser</span><span class='period'>.</span><span class='id identifier rubyid_transient?'>transient?</span>

  <span class='id identifier rubyid_tuser'>tuser</span><span class='period'>.</span><span class='id identifier rubyid_make_permanent'>make_permanent</span><span class='lparen'>(</span><span class='id identifier rubyid_buname'>buname</span><span class='rparen'>)</span>
  <span class='ivar'>@allbotusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_tuser'>tuser</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_tuser'>tuser</span>

  <span class='kw'>return</span> <span class='id identifier rubyid_tuser'>tuser</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="permit?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>permit?</strong>(user, cmdtxt, channel = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks if User <em>user</em> can do <em>cmd</em> on <em>chan</em>.</p>

<p>Permission are checked in this order, until a true or false is returned:</p>
<ul><li>
<p>associated BotUser on <em>chan</em></p>
</li><li>
<p>associated BotUser on all channels</p>
</li><li>
<p>everyone on <em>chan</em></p>
</li><li>
<p>everyone on all channels</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


872
873
874
875
876
877
878
879
880
881
882
883
884
885
886
887
888
889
890
891
892
893
894
895
896
897
898
899
900
901
902
903</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 872</span>

<span class='kw'>def</span> <span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='comma'>,</span> <span class='id identifier rubyid_channel'>channel</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_class'>class</span> <span class='op'>&lt;=</span> <span class='const'>BotUser</span>
    <span class='id identifier rubyid_botuser'>botuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_botuser'>botuser</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_botuser'>botuser</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_cmd'>cmd</span> <span class='op'>=</span> <span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_auth_command'>to_irc_auth_command</span>

  <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='id identifier rubyid_channel'>channel</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_chan'>chan</span>
  <span class='kw'>when</span> <span class='const'>User</span>
    <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>?</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>when</span> <span class='const'>Channel</span>
    <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='id identifier rubyid_chan'>chan</span><span class='period'>.</span><span class='id identifier rubyid_name'>name</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_allow'>allow</span> <span class='op'>=</span> <span class='kw'>nil</span>

  <span class='id identifier rubyid_allow'>allow</span> <span class='op'>=</span> <span class='id identifier rubyid_botuser'>botuser</span><span class='period'>.</span><span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_chan'>chan</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_allow'>allow</span> <span class='kw'>unless</span> <span class='id identifier rubyid_allow'>allow</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='id identifier rubyid_allow'>allow</span> <span class='op'>=</span> <span class='id identifier rubyid_botuser'>botuser</span><span class='period'>.</span><span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='id identifier rubyid_allow'>allow</span> <span class='kw'>unless</span> <span class='id identifier rubyid_allow'>allow</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_botuser'>botuser</span> <span class='op'>==</span> <span class='id identifier rubyid_everyone'>everyone</span>
    <span class='id identifier rubyid_allow'>allow</span> <span class='op'>=</span> <span class='id identifier rubyid_everyone'>everyone</span><span class='period'>.</span><span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_chan'>chan</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_allow'>allow</span> <span class='kw'>unless</span> <span class='id identifier rubyid_allow'>allow</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_allow'>allow</span> <span class='op'>=</span> <span class='id identifier rubyid_everyone'>everyone</span><span class='period'>.</span><span class='id identifier rubyid_permit?'>permit?</span><span class='lparen'>(</span><span class='id identifier rubyid_cmd'>cmd</span><span class='rparen'>)</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_allow'>allow</span> <span class='kw'>unless</span> <span class='id identifier rubyid_allow'>allow</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Could not check permission for user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> to run </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_cmdtxt'>cmdtxt</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_chan'>chan</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_changed-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>reset_changed</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


686
687
688</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 686</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_changed'>reset_changed</span>
  <span class='ivar'>@has_changes</span> <span class='op'>=</span> <span class='kw'>false</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset_hashes-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>reset_hashes</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>resets the hashes</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


695
696
697
698
699
700
701
702</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 695</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset_hashes'>reset_hashes</span>
  <span class='ivar'>@botusers</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@maskdb</span> <span class='op'>=</span> <span class='const'>NetmaskDb</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@allbotusers</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='lbracket'>[</span><span class='id identifier rubyid_everyone'>everyone</span><span class='comma'>,</span> <span class='id identifier rubyid_botowner'>botowner</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
    <span class='ivar'>@allbotusers</span><span class='lbracket'>[</span><span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_username'>username</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_x'>x</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="save_array-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>save_array</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


723
724
725
726
727</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 723</span>

<span class='kw'>def</span> <span class='id identifier rubyid_save_array'>save_array</span>
  <span class='ivar'>@allbotusers</span><span class='period'>.</span><span class='id identifier rubyid_values'>values</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_x'>x</span><span class='op'>|</span>
    <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_transient?'>transient?</span> <span class='op'>?</span> <span class='kw'>nil</span> <span class='op'>:</span> <span class='id identifier rubyid_x'>x</span><span class='period'>.</span><span class='id identifier rubyid_to_hash'>to_hash</span>
  <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_compact'>compact</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="set_changed-instance_method">
  
    - (<tt><span class='object_link'><a href="../../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>set_changed</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


682
683
684</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/botuser.rb', line 682</span>

<span class='kw'>def</span> <span class='id identifier rubyid_set_changed'>set_changed</span>
  <span class='ivar'>@has_changes</span> <span class='op'>=</span> <span class='kw'>true</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Mar  9 04:49:04 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>