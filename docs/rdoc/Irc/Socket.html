<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Irc::Socket
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Irc/Socket.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Irc.html" title="Irc (module)">Irc</a></span></span>
     &raquo; 
    <span class="title">Socket</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Irc::Socket
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Irc::Socket</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>wrapped TCPSocket for communication with the server. emulates a subset of
TCPSocket functionality</p>


  </div>
</div>
<div class="tags">
  

</div><h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="Socket/IdentityFilter.html" title="Irc::Socket::IdentityFilter (class)">IdentityFilter</a></span>
    
  
</p>

  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="MAX_IRC_SEND_PENALTY-constant" class="">MAX_IRC_SEND_PENALTY =
          
        </dt>
        <dd><pre class="code"><span class='int'>10</span></pre></dd>
      
    </dl>
  




  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bytes_received-instance_method" title="#bytes_received (instance method)">- (Object) <strong>bytes_received</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>total number of bytes received from the irc server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#bytes_sent-instance_method" title="#bytes_sent (instance method)">- (Object) <strong>bytes_sent</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>total number of bytes sent to the irc server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#filter-instance_method" title="#filter (instance method)">- (Object) <strong>filter</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>an optional filter object.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#lines_received-instance_method" title="#lines_received (instance method)">- (Object) <strong>lines_received</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>total number of lines received from the irc server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#lines_sent-instance_method" title="#lines_sent (instance method)">- (Object) <strong>lines_sent</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>total number of lines sent to the irc server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#penalty_pct-instance_method" title="#penalty_pct (instance method)">- (Object) <strong>penalty_pct</strong> </a>
    

    
  </span>
  
  
  
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>penalty multiplier (percent).</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server_uri-instance_method" title="#server_uri (instance method)">- (Object) <strong>server_uri</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>normalized uri of the current server.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#throttle_bytes-instance_method" title="#throttle_bytes (instance method)">- (Object) <strong>throttle_bytes</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>accumulator for the throttle.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#clearq-instance_method" title="#clearq (instance method)">- (Object) <strong>clearq</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-instance_method" title="#connect (instance method)">- (Object) <strong>connect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>open a TCP connection to the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connected%3F-instance_method" title="#connected? (instance method)">- (Boolean) <strong>connected?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#emergency_puts-instance_method" title="#emergency_puts (instance method)">- (Object) <strong>emergency_puts</strong>(message, penalty = false) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>used to send lines to the remote IRCd by skipping the queue message: IRC
message to send it should only be used for stuff that *must not* be queued,
i.e.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush-instance_method" title="#flush (instance method)">- (Object) <strong>flush</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>flush the TCPSocket.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#gets-instance_method" title="#gets (instance method)">- (Object) <strong>gets</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>get the next line from the server (blocks).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#handle_socket_error-instance_method" title="#handle_socket_error (instance method)">- (Object) <strong>handle_socket_error</strong>(string, e) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Socket) <strong>initialize</strong>(server_list, host, opts = {}) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><dl class="rdoc-list note-list"><dt>server_list
<dd><dl class="rdoc-list note-list"><dt>list of servers to connect to host
<dd>
<p>optional local host to bind to (ruby 1.7+ required) create a new
Irc::Socket.</p>
</dd></dl>
</dd></dl>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#queue-instance_method" title="#queue (instance method)">- (Object) <strong>queue</strong>(msg, chan = nil, ring = 0) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'></div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#select-instance_method" title="#select (instance method)">- (Object) <strong>select</strong>(timeout = nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Wraps Kernel.select on the socket.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#shutdown-instance_method" title="#shutdown (instance method)">- (Object) <strong>shutdown</strong>(how = 2) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>shutdown the connection to the server.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Irc::Socket (class)">Socket</a></span></tt>) <strong>initialize</strong>(server_list, host, opts = {}) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <dl class="rdoc-list note-list"><dt>server_list
<dd>
<p>list of servers to connect to</p>
</dd><dt>host
<dd>
<p>optional local host to bind to (ruby 1.7+ required)</p>
</dd></dl>

<p>create a new Irc::Socket</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 277</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='id identifier rubyid_server_list'>server_list</span><span class='comma'>,</span> <span class='id identifier rubyid_host'>host</span><span class='comma'>,</span> <span class='id identifier rubyid_opts'>opts</span><span class='op'>=</span><span class='lbrace'>{</span><span class='rbrace'>}</span><span class='rparen'>)</span>
  <span class='ivar'>@server_list</span> <span class='op'>=</span> <span class='id identifier rubyid_server_list'>server_list</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='ivar'>@server_uri</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@conn_count</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@host</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span>
  <span class='ivar'>@sock</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@filter</span> <span class='op'>=</span> <span class='const'>IdentityFilter</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@spooler</span> <span class='op'>=</span> <span class='kw'>false</span>
  <span class='ivar'>@lines_sent</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@lines_received</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@ssl</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ssl</span><span class='rbracket'>]</span>
  <span class='ivar'>@ssl_verify</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ssl_verify</span><span class='rbracket'>]</span>
  <span class='ivar'>@ssl_ca_file</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ssl_ca_file</span><span class='rbracket'>]</span>
  <span class='ivar'>@ssl_ca_path</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:ssl_ca_path</span><span class='rbracket'>]</span>
  <span class='ivar'>@penalty_pct</span> <span class='op'>=</span> <span class='id identifier rubyid_opts'>opts</span><span class='lbracket'>[</span><span class='symbol'>:penalty_pct</span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='int'>100</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="bytes_received-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bytes_received</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>total number of bytes received from the irc server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


243
244
245</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 243</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bytes_received'>bytes_received</span>
  <span class='ivar'>@bytes_received</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="bytes_sent-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>bytes_sent</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>total number of bytes sent to the irc server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 240</span>

<span class='kw'>def</span> <span class='id identifier rubyid_bytes_sent'>bytes_sent</span>
  <span class='ivar'>@bytes_sent</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="filter=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="filter-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>filter</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>an optional filter object. we call @filter.in(data) for all incoming data
and @filter.out(data) for all outgoing data</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


250
251
252</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 250</span>

<span class='kw'>def</span> <span class='id identifier rubyid_filter'>filter</span>
  <span class='ivar'>@filter</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="lines_received-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>lines_received</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>total number of lines received from the irc server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


237
238
239</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 237</span>

<span class='kw'>def</span> <span class='id identifier rubyid_lines_received'>lines_received</span>
  <span class='ivar'>@lines_received</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="lines_sent-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>lines_sent</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>total number of lines sent to the irc server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


234
235
236</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 234</span>

<span class='kw'>def</span> <span class='id identifier rubyid_lines_sent'>lines_sent</span>
  <span class='ivar'>@lines_sent</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id="penalty_pct=-instance_method"></span>
      <div class="method_details ">
  <h3 class="signature " id="penalty_pct-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>penalty_pct</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>penalty multiplier (percent)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 256</span>

<span class='kw'>def</span> <span class='id identifier rubyid_penalty_pct'>penalty_pct</span>
  <span class='ivar'>@penalty_pct</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="server_uri-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>server_uri</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>normalized uri of the current server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


253
254
255</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 253</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server_uri'>server_uri</span>
  <span class='ivar'>@server_uri</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="throttle_bytes-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>throttle_bytes</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>accumulator for the throttle</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


246
247
248</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 246</span>

<span class='kw'>def</span> <span class='id identifier rubyid_throttle_bytes'>throttle_bytes</span>
  <span class='ivar'>@throttle_bytes</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="clearq-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>clearq</strong> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


398
399
400</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 398</span>

<span class='kw'>def</span> <span class='id identifier rubyid_clearq'>clearq</span>
  <span class='ivar'>@sendq</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>connect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>open a TCP connection to the server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 299</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connect'>connect</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_connected?'>connected?</span>
    <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>reconnecting while connected</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=</span> <span class='ivar'>@server_list</span><span class='lbracket'>[</span><span class='ivar'>@conn_count</span> <span class='op'>%</span> <span class='ivar'>@server_list</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
  <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>irc://</span><span class='tstring_end'>&#39;</span></span> <span class='op'>+</span> <span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='kw'>if</span> <span class='op'>!</span><span class='lparen'>(</span><span class='id identifier rubyid_srv_uri'>srv_uri</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>:\/\/</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
  <span class='ivar'>@conn_count</span> <span class='op'>+=</span> <span class='int'>1</span>
  <span class='ivar'>@server_uri</span> <span class='op'>=</span> <span class='const'>URI</span><span class='period'>.</span><span class='id identifier rubyid_parse'>parse</span><span class='lparen'>(</span><span class='id identifier rubyid_srv_uri'>srv_uri</span><span class='rparen'>)</span>
  <span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span> <span class='op'>=</span> <span class='int'>6667</span> <span class='kw'>if</span> <span class='op'>!</span><span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span>

  <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>connection attempt \#</span><span class='embexpr_beg'>#{</span><span class='ivar'>@conn_count</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span><span class='embexpr_end'>}</span><span class='tstring_content'>:</span><span class='embexpr_beg'>#{</span><span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># if the host is a bracketed (IPv6) address, strip the brackets
</span>  <span class='comment'># since Ruby doesn&#39;t like them in the Socket host parameter
</span>  <span class='comment'># FIXME it would be safer to have it check for a valid
</span>  <span class='comment'># IPv6 bracketed address rather than just stripping the brackets
</span>  <span class='id identifier rubyid_srv_host'>srv_host</span> <span class='op'>=</span> <span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_srv_host'>srv_host</span><span class='period'>.</span><span class='id identifier rubyid_match'>match</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\A\[(.*)\]\z</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_srv_host'>srv_host</span> <span class='op'>=</span> <span class='backref'>$1</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span><span class='lparen'>(</span><span class='ivar'>@host</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_sock'>sock</span><span class='op'>=</span><span class='const'>TCPSocket</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_srv_host'>srv_host</span><span class='comma'>,</span> <span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='comma'>,</span> <span class='ivar'>@host</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span> <span class='const'>ArgumentError</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
      <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Your version of ruby does not support binding to a </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>specific local address, please upgrade if you wish </span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>to use HOST = foo</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>(this option has been disabled in order to continue)</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_sock'>sock</span><span class='op'>=</span><span class='const'>TCPSocket</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_srv_host'>srv_host</span><span class='comma'>,</span> <span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='op'>=</span><span class='const'>TCPSocket</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_srv_host'>srv_host</span><span class='comma'>,</span> <span class='ivar'>@server_uri</span><span class='period'>.</span><span class='id identifier rubyid_port'>port</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>if</span><span class='lparen'>(</span><span class='ivar'>@ssl</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_require'>require</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>openssl</span><span class='tstring_end'>&#39;</span></span>
    <span class='id identifier rubyid_ssl_context'>ssl_context</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLContext</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='ivar'>@ssl_verify</span>
      <span class='id identifier rubyid_ssl_context'>ssl_context</span><span class='period'>.</span><span class='id identifier rubyid_ca_file'>ca_file</span> <span class='op'>=</span> <span class='ivar'>@ssl_ca_file</span> <span class='kw'>if</span> <span class='ivar'>@ssl_ca_file</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='ivar'>@ssl_ca_file</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_ssl_context'>ssl_context</span><span class='period'>.</span><span class='id identifier rubyid_ca_path'>ca_path</span> <span class='op'>=</span> <span class='ivar'>@ssl_ca_path</span> <span class='kw'>if</span> <span class='ivar'>@ssl_ca_path</span> <span class='kw'>and</span> <span class='kw'>not</span> <span class='ivar'>@ssl_ca_path</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_ssl_context'>ssl_context</span><span class='period'>.</span><span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_PEER</span> 
    <span class='kw'>else</span>
      <span class='id identifier rubyid_ssl_context'>ssl_context</span><span class='period'>.</span><span class='id identifier rubyid_verify_mode'>verify_mode</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>VERIFY_NONE</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_sock'>sock</span> <span class='op'>=</span> <span class='const'>OpenSSL</span><span class='op'>::</span><span class='const'>SSL</span><span class='op'>::</span><span class='const'>SSLSocket</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_sock'>sock</span><span class='comma'>,</span> <span class='id identifier rubyid_ssl_context'>ssl_context</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_sync_close'>sync_close</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_sock'>sock</span><span class='period'>.</span><span class='id identifier rubyid_connect'>connect</span>
  <span class='kw'>end</span>
  <span class='ivar'>@sock</span> <span class='op'>=</span> <span class='id identifier rubyid_sock'>sock</span>
  <span class='ivar'>@last_send</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@flood_send</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@burst</span> <span class='op'>=</span> <span class='int'>0</span>
  <span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_extend'>extend</span><span class='lparen'>(</span><span class='const'>MonitorMixin</span><span class='rparen'>)</span>
  <span class='ivar'>@sendq</span> <span class='op'>=</span> <span class='const'>MessageQueue</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='ivar'>@qthread</span> <span class='op'>=</span> <span class='const'>Thread</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_writer_loop'>writer_loop</span> <span class='rbrace'>}</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connected?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>connected?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


294
295
296</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 294</span>

<span class='kw'>def</span> <span class='id identifier rubyid_connected?'>connected?</span>
  <span class='op'>!</span><span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="emergency_puts-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>emergency_puts</strong>(message, penalty = false) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>used to send lines to the remote IRCd by skipping the queue message: IRC
message to send it should only be used for stuff that *must not* be queued,
i.e. the initial PASS, NICK and USER command or the final QUIT message</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


362
363
364
365
366
367</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 362</span>

<span class='kw'>def</span> <span class='id identifier rubyid_emergency_puts'>emergency_puts</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_penalty'>penalty</span> <span class='op'>=</span> <span class='kw'>false</span><span class='rparen'>)</span>
  <span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_synchronize'>synchronize</span> <span class='kw'>do</span>
    <span class='comment'># debug &quot;In puts - got @sock&quot;
</span>    <span class='id identifier rubyid_puts_critical'>puts_critical</span><span class='lparen'>(</span><span class='id identifier rubyid_message'>message</span><span class='comma'>,</span> <span class='id identifier rubyid_penalty'>penalty</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>flush</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>flush the TCPSocket</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


403
404
405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 403</span>

<span class='kw'>def</span> <span class='id identifier rubyid_flush'>flush</span>
  <span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_flush'>flush</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="gets-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>gets</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>get the next line from the server (blocks)</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


378
379
380
381
382
383
384
385
386
387
388
389
390
391
392</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 378</span>

<span class='kw'>def</span> <span class='id identifier rubyid_gets'>gets</span>
  <span class='kw'>if</span> <span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
    <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>socket get attempted while closed</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='kw'>nil</span>
  <span class='kw'>end</span>
  <span class='kw'>begin</span>
    <span class='id identifier rubyid_reply'>reply</span> <span class='op'>=</span> <span class='ivar'>@filter</span><span class='period'>.</span><span class='id identifier rubyid_in'>in</span><span class='lparen'>(</span><span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_gets'>gets</span><span class='rparen'>)</span>
    <span class='ivar'>@lines_received</span> <span class='op'>+=</span> <span class='int'>1</span>
    <span class='id identifier rubyid_reply'>reply</span><span class='period'>.</span><span class='id identifier rubyid_strip!'>strip!</span> <span class='kw'>if</span> <span class='id identifier rubyid_reply'>reply</span>
    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>RECV: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_reply'>reply</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span> <span class='id identifier rubyid_reply'>reply</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_handle_socket_error'>handle_socket_error</span><span class='lparen'>(</span><span class='symbol'>:RECV</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="handle_socket_error-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>handle_socket_error</strong>(string, e) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>SocketError</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


369
370
371
372
373
374
375</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 369</span>

<span class='kw'>def</span> <span class='id identifier rubyid_handle_socket_error'>handle_socket_error</span><span class='lparen'>(</span><span class='id identifier rubyid_string'>string</span><span class='comma'>,</span> <span class='id identifier rubyid_e'>e</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_string'>string</span><span class='embexpr_end'>}</span><span class='tstring_content'> failed: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_pretty_inspect'>pretty_inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='comment'># We assume that an error means that there are connection
</span>  <span class='comment'># problems and that we should reconnect, so we
</span>  <span class='id identifier rubyid_shutdown'>shutdown</span>
  <span class='id identifier rubyid_raise'>raise</span> <span class='const'>SocketError</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="queue-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>queue</strong>(msg, chan = nil, ring = 0) 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


394
395
396</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 394</span>

<span class='kw'>def</span> <span class='id identifier rubyid_queue'>queue</span><span class='lparen'>(</span><span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='op'>=</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_ring'>ring</span><span class='op'>=</span><span class='int'>0</span><span class='rparen'>)</span>
  <span class='ivar'>@sendq</span><span class='period'>.</span><span class='id identifier rubyid_push'>push</span> <span class='id identifier rubyid_msg'>msg</span><span class='comma'>,</span> <span class='id identifier rubyid_chan'>chan</span><span class='comma'>,</span> <span class='id identifier rubyid_ring'>ring</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="select-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>select</strong>(timeout = nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Wraps Kernel.select on the socket</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


408
409
410</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 408</span>

<span class='kw'>def</span> <span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='id identifier rubyid_timeout'>timeout</span><span class='op'>=</span><span class='kw'>nil</span><span class='rparen'>)</span>
  <span class='const'>Kernel</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='ivar'>@sock</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_timeout'>timeout</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="shutdown-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>shutdown</strong>(how = 2) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>shutdown the connection to the server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


413
414
415
416
417
418
419
420
421
422
423
424
425</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/ircsocket.rb', line 413</span>

<span class='kw'>def</span> <span class='id identifier rubyid_shutdown'>shutdown</span><span class='lparen'>(</span><span class='id identifier rubyid_how'>how</span><span class='op'>=</span><span class='int'>2</span><span class='rparen'>)</span>
  <span class='kw'>return</span> <span class='kw'>unless</span> <span class='id identifier rubyid_connected?'>connected?</span>
  <span class='ivar'>@qthread</span><span class='period'>.</span><span class='id identifier rubyid_kill'>kill</span>
  <span class='ivar'>@qthread</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='kw'>begin</span>
    <span class='ivar'>@sock</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
  <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span>
    <span class='id identifier rubyid_error'>error</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>error while shutting down: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_pretty_inspect'>pretty_inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
  <span class='kw'>end</span>
  <span class='ivar'>@sock</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@server_uri</span> <span class='op'>=</span> <span class='kw'>nil</span>
  <span class='ivar'>@sendq</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Mar  9 04:49:08 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>