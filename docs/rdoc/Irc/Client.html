<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: Irc::Client
  
    &mdash; Documentation by YARD 0.8.7.6
  
</title>

  <link rel="stylesheet" href="../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../';
  framesUrl = "../frames.html#!Irc/Client.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../_index.html">Index (C)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../Irc.html" title="Irc (module)">Irc</a></span></span>
     &raquo; 
    <span class="title">Client</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: Irc::Client
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">Irc::Client</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>Implements RFC 2812 and prior IRC RFCs.</p>

<p>Clients should register Proc{}s to handle the various server events, and
the Client class will handle dispatch.</p>


  </div>
</div>
<div class="tags">
  

</div>



  <h2>Instance Attribute Summary <small>(<a href="#" class="summary_toggle">collapse</a>)</small></h2>
  <ul class="summary">
    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#server-instance_method" title="#server (instance method)">- (Object) <strong>server</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the Server we&#39;re connected to.</p>
</div></span>
  
</li>

    
      <li class="public ">
  <span class="summary_signature">
    
      <a href="#user-instance_method" title="#user (instance method)">- (Object) <strong>user</strong> </a>
    

    
  </span>
  
  
  
    
      <span class="note title readonly">readonly</span>
    
    
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>the User representing us on that server.</p>
</div></span>
  
</li>

    
  </ul>




  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">- (Object) <strong>[]=</strong>(key, value) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><dl class="rdoc-list note-list"><dt>key
<dd><dl class="rdoc-list note-list"><dt>server event to handle value
<dd>
<p>proc object called when event occurs set a handler for a server event.</p>
</dd></dl>
</dd></dl>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#deletehandler-instance_method" title="#deletehandler (instance method)">- (Object) <strong>deletehandler</strong>(key) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><dl class="rdoc-list note-list"><dt>key
<dd>
<p>event name remove a handler for a server event.</p>
</dd></dl>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Client) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Create a new Client instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#process-instance_method" title="#process (instance method)">- (Object) <strong>process</strong>(serverstring) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>takes a server string, checks for PING, PRIVMSG, NOTIFY, etc, and parses
numeric server replies, calling the appropriate handler for each, and
sending it a hash containing the data from the server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#reset-instance_method" title="#reset (instance method)">- (Object) <strong>reset</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Clear the server and reset the user.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="" title="Irc::Client (class)">Client</a></span></tt>) <strong>initialize</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Create a new Client instance</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


967
968
969
970
971
972
973
974
975
976
977
978
979</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 967</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span>
  <span class='ivar'>@server</span> <span class='op'>=</span> <span class='const'>Server</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>         <span class='comment'># The Server
</span>  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*!*@*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>     <span class='comment'># The User representing the client on this Server
</span>
  <span class='ivar'>@handlers</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>

  <span class='comment'># This is used by some messages to build lists of users that
</span>  <span class='comment'># will be delegated when the ENDOF... message is received
</span>  <span class='ivar'>@tmpusers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>

  <span class='comment'># Same as above, just for bans
</span>  <span class='ivar'>@tmpbans</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>

  <div id="instance_attr_details" class="attr_details">
    <h2>Instance Attribute Details</h2>
    
      
      <span id=""></span>
      <div class="method_details first">
  <h3 class="signature first" id="server-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>server</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the Server we&#39;re connected to</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


962
963
964</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 962</span>

<span class='kw'>def</span> <span class='id identifier rubyid_server'>server</span>
  <span class='ivar'>@server</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      
      <span id=""></span>
      <div class="method_details ">
  <h3 class="signature " id="user-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>user</strong>  <span class="extras">(readonly)</span>
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>the User representing us on that server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


964
965
966</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 964</span>

<span class='kw'>def</span> <span class='id identifier rubyid_user'>user</span>
  <span class='ivar'>@user</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="[]=-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]=</strong>(key, value) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <dl class="rdoc-list note-list"><dt>key
<dd>
<p>server event to handle</p>
</dd><dt>value
<dd>
<p>proc object called when event occurs</p>
</dd></dl>

<p>set a handler for a server event</p>

<h2 id="label-server+events+currently+supported-3A">server events currently supported:</h2>

<p>TODO handle errors ERR_CHANOPRIVSNEEDED, ERR_CANNOTSENDTOCHAN</p>
<dl class="rdoc-list note-list"><dt>welcome
<dd>
<p>server welcome message on connect</p>
</dd><dt>yourhost
<dd>
<p>your host details (on connection)</p>
</dd><dt>created
<dd>
<p>when the server was started</p>
</dd><dt>isupport
<dd>
<p>information about what this server supports</p>
</dd><dt>ping
<dd>
<p>server pings you (default handler returns a pong)</p>
</dd><dt>nicktaken
<dd>
<p>you tried to change nick to one that&#39;s in use</p>
</dd><dt>badnick
<dd>
<p>you tried to change nick to one that&#39;s invalid</p>
</dd><dt>topic
<dd>
<p>someone changed the topic of a channel</p>
</dd><dt>topicinfo
<dd>
<p>on joining a channel or asking for the topic, tells you who set it and when</p>
</dd><dt>names
<dd>
<p>server sends list of channel members when you join</p>
</dd><dt>motd
<dd>
<p>server message of the day</p>
</dd><dt>privmsg
<dd>
<p>privmsg, the core of IRC, a message to you from someone</p>
</dd><dt>public
<dd>
<p>optionally instead of getting privmsg you can hook to only the public onesâ€¦</p>
</dd><dt>msg
<dd>
<p>or only the private ones, or both</p>
</dd><dt>kick
<dd>
<p>someone got kicked from a channel</p>
</dd><dt>part
<dd>
<p>someone left a channel</p>
</dd><dt>quit
<dd>
<p>someone quit IRC</p>
</dd><dt>join
<dd>
<p>someone joined a channel</p>
</dd><dt>changetopic
<dd>
<p>the topic of a channel changed</p>
</dd><dt>invite
<dd>
<p>you are invited to a channel</p>
</dd><dt>nick
<dd>
<p>someone changed their nick</p>
</dd><dt>mode
<dd>
<p>a mode change</p>
</dd><dt>notice
<dd>
<p>someone sends you a notice</p>
</dd><dt>unknown
<dd>
<p>any other message not handled by the above</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1021
1022
1023</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 1021</span>

<span class='kw'>def</span> <span class='op'>[]=</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='comma'>,</span> <span class='id identifier rubyid_value'>value</span><span class='rparen'>)</span>
  <span class='ivar'>@handlers</span><span class='lbracket'>[</span><span class='id identifier rubyid_key'>key</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_value'>value</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="deletehandler-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>deletehandler</strong>(key) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <dl class="rdoc-list note-list"><dt>key
<dd>
<p>event name</p>
</dd></dl>

<p>remove a handler for a server event</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1027
1028
1029</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 1027</span>

<span class='kw'>def</span> <span class='id identifier rubyid_deletehandler'>deletehandler</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
  <span class='ivar'>@handlers</span><span class='period'>.</span><span class='id identifier rubyid_delete'>delete</span><span class='lparen'>(</span><span class='id identifier rubyid_key'>key</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="process-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>process</strong>(serverstring) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>takes a server string, checks for PING, PRIVMSG, NOTIFY, etc, and parses
numeric server replies, calling the appropriate handler for each, and
sending it a hash containing the data from the server</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1034
1035
1036
1037
1038
1039
1040
1041
1042
1043
1044
1045
1046
1047
1048
1049
1050
1051
1052
1053
1054
1055
1056
1057
1058
1059
1060
1061
1062
1063
1064
1065
1066
1067
1068
1069
1070
1071
1072
1073
1074
1075
1076
1077
1078
1079
1080
1081
1082
1083
1084
1085
1086
1087
1088
1089
1090
1091
1092
1093
1094
1095
1096
1097
1098
1099
1100
1101
1102
1103
1104
1105
1106
1107
1108
1109
1110
1111
1112
1113
1114
1115
1116
1117
1118
1119
1120
1121
1122
1123
1124
1125
1126
1127
1128
1129
1130
1131
1132
1133
1134
1135
1136
1137
1138
1139
1140
1141
1142
1143
1144
1145
1146
1147
1148
1149
1150
1151
1152
1153
1154
1155
1156
1157
1158
1159
1160
1161
1162
1163
1164
1165
1166
1167
1168
1169
1170
1171
1172
1173
1174
1175
1176
1177
1178
1179
1180
1181
1182
1183
1184
1185
1186
1187
1188
1189
1190
1191
1192
1193
1194
1195
1196
1197
1198
1199
1200
1201
1202
1203
1204
1205
1206
1207
1208
1209
1210
1211
1212
1213
1214
1215
1216
1217
1218
1219
1220
1221
1222
1223
1224
1225
1226
1227
1228
1229
1230
1231
1232
1233
1234
1235
1236
1237
1238
1239
1240
1241
1242
1243
1244
1245
1246
1247
1248
1249
1250
1251
1252
1253
1254
1255
1256
1257
1258
1259
1260
1261
1262
1263
1264
1265
1266
1267
1268
1269
1270
1271
1272
1273
1274
1275
1276
1277
1278
1279
1280
1281
1282
1283
1284
1285
1286
1287
1288
1289
1290
1291
1292
1293
1294
1295
1296
1297
1298
1299
1300
1301
1302
1303
1304
1305
1306
1307
1308
1309
1310
1311
1312
1313
1314
1315
1316
1317
1318
1319
1320
1321
1322
1323
1324
1325
1326
1327
1328
1329
1330
1331
1332
1333
1334
1335
1336
1337
1338
1339
1340
1341
1342
1343
1344
1345
1346
1347
1348
1349
1350
1351
1352
1353
1354
1355
1356
1357
1358
1359
1360
1361
1362
1363
1364
1365
1366
1367
1368
1369
1370
1371
1372
1373
1374
1375
1376
1377
1378
1379
1380
1381
1382
1383
1384
1385
1386
1387
1388
1389
1390
1391
1392
1393
1394
1395
1396
1397
1398
1399
1400
1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419
1420
1421
1422
1423
1424
1425
1426
1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449
1450
1451
1452
1453
1454
1455
1456
1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480
1481
1482
1483
1484
1485
1486
1487
1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512
1513
1514
1515
1516
1517
1518</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 1034</span>

<span class='kw'>def</span> <span class='id identifier rubyid_process'>process</span><span class='lparen'>(</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_data'>data</span> <span class='op'>=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
  <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:serverstring</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_serverstring'>serverstring</span>

  <span class='kw'>unless</span> <span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(:(\S+)\s)?(\S+)(\s(.*))?$</span><span class='regexp_end'>/</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='const'>ServerMessageParseError</span><span class='comma'>,</span> <span class='lparen'>(</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_chomp'>chomp</span> <span class='kw'>rescue</span> <span class='id identifier rubyid_serverstring'>serverstring</span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='id identifier rubyid_prefix'>prefix</span><span class='comma'>,</span> <span class='id identifier rubyid_command'>command</span><span class='comma'>,</span> <span class='id identifier rubyid_params'>params</span> <span class='op'>=</span> <span class='backref'>$2</span><span class='comma'>,</span> <span class='backref'>$3</span><span class='comma'>,</span> <span class='backref'>$5</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>!=</span> <span class='kw'>nil</span>
    <span class='comment'># Most servers will send a full nick!user@host prefix for
</span>    <span class='comment'># messages from users. Therefore, when the prefix doesn&#39;t match this
</span>    <span class='comment'># syntax it&#39;s usually the server hostname.
</span>    <span class='comment'>#
</span>    <span class='comment'># This is not always true, though, since some servers do not send a
</span>    <span class='comment'># full hostmask for user messages.
</span>    <span class='comment'>#
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_prefix'>prefix</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^</span><span class='embexpr_beg'>#{</span><span class='const'>Regexp</span><span class='op'>::</span><span class='const'>Irc</span><span class='op'>::</span><span class='const'>BANG_AT</span><span class='embexpr_end'>}</span><span class='tstring_content'>$</span><span class='regexp_end'>/</span></span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_prefix'>prefix</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='kw'>if</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
        <span class='kw'>if</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span> <span class='op'>!=</span> <span class='id identifier rubyid_prefix'>prefix</span>
          <span class='comment'># TODO do we want to be able to differentiate messages that are passed on to us from /other/ servers?
</span>          <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Origin </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_prefix'>prefix</span><span class='embexpr_end'>}</span><span class='tstring_content'> for message\n\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>\nis neither a user hostmask nor the server hostname\nI&#39;ll pretend that it&#39;s from the server anyway</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span>
        <span class='kw'>else</span>
          <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span>
        <span class='kw'>end</span>
      <span class='kw'>else</span>
        <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_instance_variable_set'>instance_variable_set</span><span class='lparen'>(</span><span class='symbol'>:@hostname</span><span class='comma'>,</span> <span class='id identifier rubyid_prefix'>prefix</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>

  <span class='comment'># split parameters in an array
</span>  <span class='id identifier rubyid_argv'>argv</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>(?!:)(\S+)|:(.*)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='id identifier rubyid_argv'>argv</span> <span class='op'>&lt;&lt;</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>||</span> <span class='backref'>$2</span><span class='rparen'>)</span> <span class='rbrace'>}</span> <span class='kw'>if</span> <span class='id identifier rubyid_params'>params</span>

  <span class='kw'>if</span> <span class='id identifier rubyid_command'>command</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(\d+)$</span><span class='regexp_end'>/</span></span> <span class='comment'># Numeric replies
</span>	<span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='comment'># A numeric reply /should/ be directed at the client, except when we&#39;re connecting with a used nick, in which case
</span>    <span class='comment'># it&#39;s directed at &#39;*&#39;
</span>    <span class='id identifier rubyid_not_us'>not_us</span> <span class='op'>=</span> <span class='op'>!</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>*</span><span class='tstring_end'>&#39;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_include?'>include?</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='rparen'>)</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_not_us'>not_us</span>
      <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server reply </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'> directed at </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> instead of client (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_num'>num</span><span class='op'>=</span><span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_num'>num</span>
    <span class='kw'>when</span> <span class='const'>RPL_WELCOME</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='comment'># &quot;Welcome to the Internet Relay Network
</span>      <span class='comment'># &lt;nick&gt;!&lt;user&gt;@&lt;host&gt;&quot;
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_not_us'>not_us</span>
        <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server thinks client (</span><span class='embexpr_beg'>#{</span><span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>) has a different nick</span><span class='tstring_end'>&quot;</span></span>
        <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>([^@!\s]+)(?:!([^@!\s]+?))?@(\S+)</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_nick'>nick</span> <span class='op'>=</span> <span class='backref'>$1</span>
        <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='backref'>$2</span>
        <span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='backref'>$3</span>
        <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Welcome message nick mismatch (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_nick'>nick</span><span class='embexpr_end'>}</span><span class='tstring_content'> vs </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_nick'>nick</span> <span class='op'>!=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span>
        <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span> <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span>
        <span class='ivar'>@user</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_host'>host</span> <span class='kw'>if</span> <span class='id identifier rubyid_host'>host</span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:welcome</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_YOURHOST</span>
      <span class='comment'># &quot;Your host is &lt;servername&gt;, running version &lt;ver&gt;&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:yourhost</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_CREATED</span>
      <span class='comment'># &quot;This server was created &lt;date&gt;&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:created</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_MYINFO</span>
      <span class='comment'># &quot;&lt;servername&gt; &lt;version&gt; &lt;available user modes&gt;
</span>      <span class='comment'># &lt;available channel modes&gt;&quot;
</span>      <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_parse_my_info'>parse_my_info</span><span class='lparen'>(</span><span class='id identifier rubyid_params'>params</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_last'>last</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:servername</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_hostname'>hostname</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:version</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_version'>version</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:usermodes</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_usermodes'>usermodes</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:chanmodes</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_chanmodes'>chanmodes</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:myinfo</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_ISUPPORT</span>
      <span class='comment'># &quot;PREFIX=(ov)@+ CHANTYPES=#&amp; :are supported by this server&quot;
</span>      <span class='comment'># &quot;MODES=4 CHANLIMIT=#:20 NICKLEN=16 USERLEN=10 HOSTLEN=63
</span>      <span class='comment'># TOPICLEN=450 KICKLEN=450 CHANNELLEN=30 KEYLEN=23 CHANTYPES=#
</span>      <span class='comment'># PREFIX=(ov)@+ CASEMAPPING=ascii CAPAB IRCD=dancer :are available
</span>      <span class='comment'># on this server&quot;
</span>      <span class='comment'>#
</span>      <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_parse_isupport'>parse_isupport</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'> </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:isupport</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>ERR_NICKNAMEINUSE</span>
      <span class='comment'># &quot;* &lt;nick&gt; :Nickname is already in use&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:nicktaken</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>ERR_ERRONEUSNICKNAME</span>
      <span class='comment'># &quot;* &lt;nick&gt; :Erroneous nickname&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:badnick</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_TOPIC</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='period'>.</span><span class='id identifier rubyid_text'>text</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:topic</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_TOPIC_INFO</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>

      <span class='comment'># This must not be an IRC::User because it might not be an actual User,
</span>      <span class='comment'># and we risk overwriting valid User data
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_irc_netmask'>to_irc_netmask</span><span class='lparen'>(</span><span class='symbol'>:server</span> <span class='op'>=&gt;</span> <span class='ivar'>@server</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:time</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='period'>.</span><span class='id identifier rubyid_set_by'>set_by</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='period'>.</span><span class='id identifier rubyid_set_on'>set_on</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:time</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:topicinfo</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_NAMREPLY</span>
      <span class='comment'># &quot;( &quot;=&quot; / &quot;*&quot; / &quot;@&quot; ) &lt;channel&gt;
</span>      <span class='comment'># :[ &quot;@&quot; / &quot;+&quot; ] &lt;nick&gt; *( &quot; &quot; [ &quot;@&quot; / &quot;+&quot; ] &lt;nick&gt; )
</span>      <span class='comment'># - &quot;@&quot; is used for secret channels, &quot;*&quot; for private
</span>      <span class='comment'># channels, and &quot;=&quot; for others (public channels).
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channeltype</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\S+</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_u'>u</span><span class='op'>|</span>
        <span class='comment'># FIXME beware of servers that allow multiple prefixes
</span>        <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^([</span><span class='embexpr_beg'>#{</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_supports'>supports</span><span class='lbracket'>[</span><span class='symbol'>:prefix</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:prefixes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='embexpr_end'>}</span><span class='tstring_content'>])?(.*)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
          <span class='id identifier rubyid_umode'>umode</span> <span class='op'>=</span> <span class='backref'>$1</span>
          <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='backref'>$2</span>
          <span class='id identifier rubyid_users'>users</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='id identifier rubyid_umode'>umode</span><span class='rbracket'>]</span>
        <span class='kw'>end</span>
      <span class='rbrace'>}</span>

      <span class='id identifier rubyid_users'>users</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_ar'>ar</span><span class='op'>|</span>
        <span class='id identifier rubyid_u'>u</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_ar'>ar</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_chan'>chan</span><span class='period'>.</span><span class='id identifier rubyid_add_user'>add_user</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='comma'>,</span> <span class='symbol'>:silent</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Adding user </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_u'>u</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='kw'>if</span> <span class='id identifier rubyid_ar'>ar</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
          <span class='id identifier rubyid_ms'>ms</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_mode_for_prefix'>mode_for_prefix</span><span class='lparen'>(</span><span class='id identifier rubyid_ar'>ar</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
          <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\twith mode </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ar'>ar</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ms'>ms</span><span class='embexpr_end'>}</span><span class='tstring_content'>)</span><span class='tstring_end'>&quot;</span></span>
          <span class='id identifier rubyid_chan'>chan</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='id identifier rubyid_ms'>ms</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_u'>u</span><span class='rparen'>)</span>
        <span class='kw'>end</span>
      <span class='rbrace'>}</span>
      <span class='ivar'>@tmpusers</span> <span class='op'>+=</span> <span class='id identifier rubyid_users'>users</span>
    <span class='kw'>when</span> <span class='const'>RPL_ENDOFNAMES</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:users</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@tmpusers</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:names</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='ivar'>@tmpusers</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>when</span> <span class='const'>RPL_BANLIST</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:mask</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:by</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:at</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span>
      <span class='ivar'>@tmpbans</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_data'>data</span>
    <span class='kw'>when</span> <span class='const'>RPL_ENDOFBANLIST</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:bans</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@tmpbans</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:banlist</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='ivar'>@tmpbans</span> <span class='op'>=</span> <span class='const'>Array</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
    <span class='kw'>when</span> <span class='const'>RPL_LUSERCLIENT</span>
      <span class='comment'># &quot;:There are &lt;integer&gt; users and &lt;integer&gt;
</span>      <span class='comment'># services on &lt;integer&gt; servers&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:luserclient</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LUSEROP</span>
      <span class='comment'># &quot;&lt;integer&gt; :operator(s) online&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:ops</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:luserop</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LUSERUNKNOWN</span>
      <span class='comment'># &quot;&lt;integer&gt; :unknown connection(s)&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:unknown</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:luserunknown</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LUSERCHANNELS</span>
      <span class='comment'># &quot;&lt;integer&gt; :channels formed&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channels</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:luserchannels</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LUSERME</span>
      <span class='comment'># &quot;:I have &lt;integer&gt; clients and &lt;integer&gt; servers&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:luserme</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>ERR_NOMOTD</span>
      <span class='comment'># &quot;:MOTD File is missing&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:motd_missing</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LOCALUSERS</span>
      <span class='comment'># &quot;:Current local  users: 3  Max: 4&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:localusers</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_GLOBALUSERS</span>
      <span class='comment'># &quot;:Current global users: 3  Max: 4&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:globalusers</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_STATSCONN</span>
      <span class='comment'># &quot;:Highest connection count: 4 (4 clients) (251 since server was
</span>      <span class='comment'># (re)started)&quot;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:statsconn</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_MOTDSTART</span>
      <span class='comment'># &quot;&lt;nick&gt; :- &lt;server&gt; Message of the Day -&quot;
</span>      <span class='kw'>if</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^-\s+(\S+)\s</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_server'>server</span> <span class='op'>=</span> <span class='backref'>$1</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Server doesn&#39;t have an RFC compliant MOTD start.</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='ivar'>@motd</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>when</span> <span class='const'>RPL_MOTD</span>
      <span class='kw'>if</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^-\s+(.*)$</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='ivar'>@motd</span> <span class='op'>&lt;&lt;</span> <span class='backref'>$1</span>
        <span class='ivar'>@motd</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>RPL_ENDOFMOTD</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:motd</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@motd</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:motd</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_DATASTR</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:text</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:datastr</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_AWAY</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_away'>away</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:away</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
	<span class='kw'>when</span> <span class='const'>RPL_WHOREPLY</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:userserver</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>4</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>5</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>6</span><span class='rbracket'>]</span> <span class='op'>=~</span> <span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>^(H|G)(\*)?(.*)?$</span><span class='regexp_end'>/</span></span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:away</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='backref'>$1</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>G</span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:ircop</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='backref'>$2</span>
        <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:modes</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='backref'>$3</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>.</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span>
          <span class='id identifier rubyid_m'>m</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_supports'>supports</span><span class='lbracket'>[</span><span class='symbol'>:prefix</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:prefixes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_index'>index</span><span class='lparen'>(</span><span class='id identifier rubyid_mode'>mode</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
          <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_supports'>supports</span><span class='lbracket'>[</span><span class='symbol'>:prefix</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:modes</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='id identifier rubyid_m'>m</span><span class='rbracket'>]</span>
        <span class='rbrace'>}</span> <span class='kw'>rescue</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='kw'>else</span>
        <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Strange WHO reply: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='kw'>end</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:hopcount</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:real_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>7</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='int'>2</span><span class='rparen'>)</span>

      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_away'>away</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:away</span><span class='rbracket'>]</span> <span class='comment'># FIXME doesn&#39;t provide the actual message
</span>      <span class='comment'># TODO ircop status
</span>      <span class='comment'># TODO userserver
</span>      <span class='comment'># TODO hopcount
</span>      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_real_name'>real_name</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:real_name</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_add_user'>add_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='symbol'>:silent</span><span class='op'>=&gt;</span><span class='kw'>true</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:modes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span>
        <span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='id identifier rubyid_mode'>mode</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
      <span class='rbrace'>}</span>

      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:who</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_ENDOFWHO</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:eowho</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_WHOISUSER</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:real_name</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>

      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:user</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_host'>host</span> <span class='op'>=</span> <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:host</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_real_name'>real_name</span> <span class='op'>=</span> <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:real_name</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='const'>RPL_WHOISSERVER</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:server</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:server_info</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='comment'># TODO update user info
</span>    <span class='kw'>when</span> <span class='const'>RPL_WHOISOPERATOR</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:operator</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='comment'># TODO update user info
</span>    <span class='kw'>when</span> <span class='const'>RPL_WHOISIDLE</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:idle</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span>
      <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_idle_since'>idle_since</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_now'>now</span> <span class='op'>-</span> <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:idle</span><span class='rbracket'>]</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>seconds idle, signon time</span><span class='tstring_end'>&#39;</span></span>
        <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:signon</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_user'>user</span><span class='period'>.</span><span class='id identifier rubyid_signon'>signon</span> <span class='op'>=</span> <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:signon</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>RPL_ENDOFWHOIS</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:whois</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@whois</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
      <span class='ivar'>@whois</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:whois</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_WHOISCHANNELS</span>
      <span class='ivar'>@whois</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:channels</span><span class='rbracket'>]</span> <span class='op'>||=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:nick</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_prechan'>prechan</span><span class='op'>|</span>
        <span class='id identifier rubyid_pfx'>pfx</span> <span class='op'>=</span> <span class='id identifier rubyid_prechan'>prechan</span><span class='period'>.</span><span class='id identifier rubyid_scan'>scan</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>[</span><span class='embexpr_beg'>#{</span><span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_supports'>supports</span><span class='lbracket'>[</span><span class='symbol'>:prefix</span><span class='rbracket'>]</span><span class='lbracket'>[</span><span class='symbol'>:prefixes</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='embexpr_end'>}</span><span class='tstring_content'>]</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span>
        <span class='id identifier rubyid_modes'>modes</span> <span class='op'>=</span> <span class='id identifier rubyid_pfx'>pfx</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_p'>p</span><span class='op'>|</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_mode_for_prefix'>mode_for_prefix</span> <span class='id identifier rubyid_p'>p</span> <span class='rbrace'>}</span>
        <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='id identifier rubyid_prechan'>prechan</span><span class='lbracket'>[</span><span class='id identifier rubyid_pfx'>pfx</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='op'>..</span><span class='id identifier rubyid_prechan'>prechan</span><span class='period'>.</span><span class='id identifier rubyid_length'>length</span><span class='rbracket'>]</span>

        <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_chan'>chan</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_add_user'>add_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='comma'>,</span> <span class='symbol'>:silent</span> <span class='op'>=&gt;</span> <span class='kw'>true</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_modes'>modes</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_mode'>mode</span><span class='op'>|</span> <span class='id identifier rubyid_channel'>channel</span><span class='period'>.</span><span class='id identifier rubyid_mode'>mode</span><span class='lbracket'>[</span><span class='id identifier rubyid_mode'>mode</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_set'>set</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span> <span class='rbrace'>}</span>

        <span class='ivar'>@whois</span><span class='lbracket'>[</span><span class='symbol'>:channels</span><span class='rbracket'>]</span> <span class='op'>&lt;&lt;</span> <span class='lbracket'>[</span><span class='id identifier rubyid_chan'>chan</span><span class='comma'>,</span> <span class='id identifier rubyid_modes'>modes</span><span class='rbracket'>]</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>RPL_LISTSTART</span>
      <span class='comment'># ignore
</span>    <span class='kw'>when</span> <span class='const'>RPL_LIST</span>
      <span class='ivar'>@list</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='id identifier rubyid_chan'>chan</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_users'>users</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_topic'>topic</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>3</span><span class='rbracket'>]</span>
      <span class='ivar'>@list</span><span class='lbracket'>[</span><span class='id identifier rubyid_chan'>chan</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>ListData</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_chan'>chan</span><span class='comma'>,</span> <span class='id identifier rubyid_users'>users</span><span class='comma'>,</span> <span class='id identifier rubyid_topic'>topic</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_LISTEND</span>
      <span class='ivar'>@list</span> <span class='op'>||=</span> <span class='const'>Hash</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:list</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@list</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:list</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_CHANNELMODEIS</span>
      <span class='id identifier rubyid_parse_mode'>parse_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='comma'>,</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='op'>..</span><span class='op'>-</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:mode</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_CREATIONTIME</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:time</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_at'>at</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_i'>to_i</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_creation_time'>creation_time</span><span class='op'>=</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:time</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:creationtime</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>RPL_CHANNEL_URL</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_url'>url</span><span class='op'>=</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:url</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:channel_url</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>when</span> <span class='const'>ERR_NOSUCHNICK</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:nosuchtarget</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_user'>user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_get_user'>get_user</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_user'>delete_user</span><span class='lparen'>(</span><span class='id identifier rubyid_user'>user</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>when</span> <span class='const'>ERR_NOSUCHCHANNEL</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:nosuchtarget</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
      <span class='kw'>if</span> <span class='id identifier rubyid_channel'>channel</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_get_channel'>get_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='rparen'>)</span>
        <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_channel'>delete_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_channel'>channel</span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown message </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:unknown</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
	<span class='kw'>return</span> <span class='comment'># We&#39;ve processed the numeric reply
</span>  <span class='kw'>end</span>

  <span class='comment'># Otherwise, the command should be a single word
</span>  <span class='kw'>case</span> <span class='id identifier rubyid_command'>command</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
  <span class='kw'>when</span> <span class='symbol'>:PING</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:pingid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:ping</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:PONG</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:pingid</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:pong</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:PRIVMSG</span>
    <span class='comment'># you can either bind to &#39;PRIVMSG&#39;, to get every one and
</span>    <span class='comment'># parse it yourself, or you can bind to &#39;MSG&#39;, &#39;PUBLIC&#39;,
</span>    <span class='comment'># etc and get it all nicely split up for you.
</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user_or_channel'>user_or_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='comment'># The previous may fail e.g. when the target is a server or something
</span>      <span class='comment'># like that (e.g. $&lt;mask&gt;). In any of these cases, we just use the
</span>      <span class='comment'># String as a target
</span>      <span class='comment'># FIXME we probably want to explicitly check for the #&lt;mask&gt; $&lt;mask&gt;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:privmsg</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>

    <span class='comment'># Now we split it
</span>    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_kind_of?'>kind_of?</span><span class='lparen'>(</span><span class='const'>Channel</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:public</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:msg</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbol'>:NOTICE</span>
    <span class='kw'>begin</span>
      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user_or_channel'>user_or_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>rescue</span>
      <span class='comment'># The previous may fail e.g. when the target is a server or something
</span>      <span class='comment'># like that (e.g. $&lt;mask&gt;). In any of these cases, we just use the
</span>      <span class='comment'># String as a target
</span>      <span class='comment'># FIXME we probably want to explicitly check for the #&lt;mask&gt; $&lt;mask&gt;
</span>      <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='kw'>case</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span>
    <span class='kw'>when</span> <span class='const'>User</span>
      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:notice</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>else</span>
      <span class='comment'># &quot;server notice&quot; (not from user, noone to reply to)
</span>      <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:snotice</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>when</span> <span class='symbol'>:KICK</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>2</span><span class='rbracket'>]</span>

    <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_user_from_channel'>delete_user_from_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@user</span>
      <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_channel'>delete_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:kick</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:PART</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>

    <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_user_from_channel'>delete_user_from_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span> <span class='op'>==</span> <span class='ivar'>@user</span>
      <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_channel'>delete_channel</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='kw'>end</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:part</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:QUIT</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:was_on</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channels'>channels</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'>ChannelList</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_list'>list</span><span class='comma'>,</span> <span class='id identifier rubyid_ch'>ch</span><span class='op'>|</span>
      <span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ch'>ch</span> <span class='kw'>if</span> <span class='id identifier rubyid_ch'>ch</span><span class='period'>.</span><span class='id identifier rubyid_has_user?'>has_user?</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_list'>list</span>
    <span class='rbrace'>}</span>

    <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_delete_user'>delete_user</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:quit</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:JOIN</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_add_user'>add_user</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:join</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:TOPIC</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='const'>Channel</span><span class='op'>::</span><span class='const'>Topic</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='const'>Time</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_topic'>topic</span><span class='period'>.</span><span class='id identifier rubyid_replace'>replace</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:topic</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:changetopic</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:INVITE</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:target</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:channel</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channel'>channel</span><span class='lparen'>(</span><span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span><span class='rparen'>)</span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:invite</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:NICK</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:is_on</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_channels'>channels</span><span class='period'>.</span><span class='id identifier rubyid_inject'>inject</span><span class='lparen'>(</span><span class='const'>ChannelList</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='rparen'>)</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_list'>list</span><span class='comma'>,</span> <span class='id identifier rubyid_ch'>ch</span><span class='op'>|</span>
      <span class='id identifier rubyid_list'>list</span> <span class='op'>&lt;&lt;</span> <span class='id identifier rubyid_ch'>ch</span> <span class='kw'>if</span> <span class='id identifier rubyid_ch'>ch</span><span class='period'>.</span><span class='id identifier rubyid_has_user?'>has_user?</span><span class='lparen'>(</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_list'>list</span>
    <span class='rbrace'>}</span>

    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:newnick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>0</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:oldnick</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span><span class='period'>.</span><span class='id identifier rubyid_dup'>dup</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:source</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_nick'>nick</span> <span class='op'>=</span> <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:newnick</span><span class='rbracket'>]</span>

    <span class='id identifier rubyid_debug'>debug</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:oldnick</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> (now </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:newnick</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>) was on </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:is_on</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>, </span><span class='tstring_end'>&#39;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>

    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:nick</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:MODE</span>
    <span class='id identifier rubyid_parse_mode'>parse_mode</span><span class='lparen'>(</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='comma'>,</span> <span class='id identifier rubyid_argv'>argv</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:mode</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>when</span> <span class='symbol'>:ERROR</span>
    <span class='id identifier rubyid_data'>data</span><span class='lbracket'>[</span><span class='symbol'>:message</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_argv'>argv</span><span class='lbracket'>[</span><span class='int'>1</span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:error</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_warning'>warning</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown message </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_serverstring'>serverstring</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_handle'>handle</span><span class='lparen'>(</span><span class='symbol'>:unknown</span><span class='comma'>,</span> <span class='id identifier rubyid_data'>data</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="reset-instance_method">
  
    - (<tt><span class='object_link'><a href="../Object.html" title="Object (class)">Object</a></span></tt>) <strong>reset</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Clear the server and reset the user</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


982
983
984
985</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File '/home/apoc/projects/ruby/rbot/lib/rbot/rfc2812.rb', line 982</span>

<span class='kw'>def</span> <span class='id identifier rubyid_reset'>reset</span>
  <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_clear'>clear</span>
  <span class='ivar'>@user</span> <span class='op'>=</span> <span class='ivar'>@server</span><span class='period'>.</span><span class='id identifier rubyid_user'>user</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>*!*@*</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Mon Mar  9 04:49:02 2015 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.6 (ruby-2.2.0).
</div>

  </body>
</html>